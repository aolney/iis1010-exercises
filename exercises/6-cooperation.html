<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252"><script src="../scripts/pencilcodeguide.js"></script>
<script>

function filterblocks(a) {
  // Show 'say' block only on browsers that support speech synthesis.
  if (!window.SpeechSynthesisUtterance || !window.speechSynthesis) {
    a = a.filter(function(b) { return !/^@?say\b/.test(b.block); });
  }
  // Show 'listen' blocks only on browsers that support speech recognition.
  if (!window.webkitSpeechRecognition || window.SpeechRecognition) {
    a = a.filter(function(b) { return !/\blisten\b/.test(b.block); });
  }
  return a.map(function(e) {
    if (!e.id) {
      // As the id (for logging), use the first (non-puncutation) word
      e.id = e.block.replace(/^\W*/, '').
             replace(/^new /, '').replace(/\W.*$/, '');
      // If that doesn't turn into anything, use the whole block text.
      if (!e.id) { e.id = e.block; }
    }
    return e;
  });
}

//  This is where we customize the blocks palette 
PencilCodeGuide.session(
{
  palette : [
    {
      name: 'Move',
      color: 'lightblue',
      blocks: filterblocks([
        {
          block: '@fd 100',
          title: 'Move forward'
        }, {
          block: '@rt 90',
          title: 'Turn right'
        }, 
        {
          block: '@lt 90',
          title: 'Turn left'
        }, {
          block: '@bk 100',
          title: 'Move backward'
        }, 
        // {
        //   block: '@rt 180, 100',
        //   title: 'Make a wide right arc'
        // }, {
        //   block: '@lt 180, 100',
        //   title: 'Make a wide left arc'
        // }, 
        {
          block: '@speed 10',
          title: 'Set the speed of the turtle'
        }, 
        // {
        //   block: '@speed Infinity',
        //   title: 'Use infinite speed'
        // }, 
        // {
        //   block: '@home()',
        //   title: 'Jump to the origin, turned up'
        // }, {
        //   block: '@turnto 270',
        //   title: 'Turn to an absolute direction'
        // }, {
        //   block: '@moveto 100, 50',
        //   title: 'Move to coordinates'
        // }, {
        //   block: '@movexy 30, 20',
        //   title: 'Move by changing x and y'
        // }, 
        {
          block: '@jumpto 100, 50',
          title: 'Jump to coordinates without drawing'
        }, 
        // {
        //   block: '@jumpxy 30, 20',
        //   title: 'Jump changing x and y without drawing'
        // }, {
        //   block: '@pause 5',
        //   title: 'Do not move for five seconds'
        // }
      ])
    }, {
      name: 'Control',
      color: 'orange',
      blocks: filterblocks([
        // {
        //   block: 'for [1..3]\n  ``',
        //   title: 'Do something multiple times'
        // }, {
        //   block: 'for x in [0...10]\n  ``',
        //   title: 'Repeat something while counting up x'
        // }, {
        //   block: 'while `` < ``\n  ``',
        //   title: '  Repeat while a condition is true'
        // }, 
        // {
        //   block: 'if `` is ``\n  ``',
        //   title: 'Do something only if a condition is true'
        // }, 
        {
          block: 'if `` > ``\n  ``',
          title: 'Do something only if the left hand side is greater than the right'
        }, 
        // {
        //   block: 'if `` is ``\n  ``\nelse\n  ``',
        //   title:
        //       'Do something if a condition is true, otherwise something else',
        //   id: 'ifelse'
        // }, {
        //   block: "forever 1, ->\n  ``",
        //   title: 'Repeat something forever at qually-spaced times'
        // }, {
        //   block: "button \'Click\', ->\n  ``",
        //   title: 'Make a button and do something when clicked'
        // }, {
        //   block: "keydown \'X\', ->\n  ``",
        //   title: 'Do something when a keyboard key is pressed'
        // }, {
        //   block: "click (e) ->\n  ``",
        //   title: 'Do something when the mouse is clicked'
        // }
      ])
    }, {
      name: 'Art',
      color: 'purple',
      blocks: filterblocks([
         {
          block: '@pen purple, 10',
          title: 'Set pen color and size'
        }, 
        // {
        //   block: '@dot green, 50',
        //   title: 'Make a dot'
        // }, {
        //   block: '@box yellow, 50',
        //   title: 'Make a square'
        // }, {
        //   block: '@fill blue',
        //   title: 'Fill traced shape'
        // }, {
        //   block: '@wear \'apple\'',
        //   title: 'Use an image for the turtle'
        // }, {
        //   block: 'img \'/img/bird\'',
        //   title: 'Write an image on the screen'
        // }, {
        //   block: '@grow 3',
        //   title: 'Grow the size of the turtle'
        // }, {
        //   block: '@hide()',
        //   title: 'Hide the main turtle'
        // }, {
        //   block: '@show()',
        //   title: 'Show the main turtle'
        // }, {
        //   block: 'cs()',
        //   title: 'Clear screen'
        // }, {
        //   block: '@pu()',
        //   title: 'Lift the pen up'
        // }, {
        //   block: '@pd()',
        //   title: 'Put the pen down'
        // }, {
        //   block: '@drawon s',
        //   title: 'Draw on sprite s'
        // }, {
        //   block: '@drawon document',
        //   title: 'Draw on the document'
        // }
      ])
    }, {
      name: 'Operators',
      color: 'lightgreen',
      blocks: filterblocks([
        {
          block: 'x = 0',
          title: 'Set a variable',
          id: 'assign'
        }, 
        // {
        //   block: 'x += 1',
        //   title: 'Increase a variable',
        //   id: 'increment'
        // }, 
        {
          block: 'f = (x) ->\n  ``',
          title: 'Define a new function',
          id: 'funcdef'
        }, {
          block: 'f(x)',
          title: 'Use a custom function',
          id: 'funccall'
        }, 
        // {
        //   block: '`` is ``',
        //   title: 'Compare two values',
        //   id: 'is'
        // }, 
        // {
        //   block: '`` < ``',
        //   title: 'Compare two values',
        //   id: 'lessthan'
        // }, 
        {
          block: '`` > ``',
          title: 'Compare two values',
          id: 'greaterthan'
        }, {
          block: '`` + ``',
          title: 'Add two numbers',
          id: 'add'
        }, {
          block: '`` - ``',
          title: 'Subtract two numbers',
          id: 'subtract'
        }, {
          block: '`` * ``',
          title: 'Multiply two numbers',
          id: 'multiply'
        }, {
          block: '`` / ``',
          title: 'Divide two numbers',
          id: 'divide'
        }, 
        // {
        //   block: '`` and ``',
        //   title: 'True if both are true',
        //   id: 'and'
        // }, {
        //   block: '`` or ``',
        //   title: 'True if either is true',
        //   id: 'or'
        // }, {
        //   block: 'not ``',
        //   title: 'True if input is false',
        //   id: 'not'
        // }, 
        {
          block: 'random 6',
          title: 'Get a random number less than n'
        }, 
        // {
        //   block: 'round ``',
        //   title: 'Round to the nearest integer'
        // }, {
        //   block: 'abs ``',
        //   title: 'Absolute value'
        // }, {
        //   block: 'max ``, ``',
        //   title: 'Get the larger of two numbers'
        // }, {
        //   block: 'min ``, ``',
        //   title: 'Get the smaller on two numbers'
        // }, {
        //   block: 'x.match /pattern/',
        //   title: 'Test if a text pattern is found in x',
        //   id: 'match'
        // }
      ])
    }, {
      name: 'Text',
      color: 'pink',
      blocks: filterblocks([
        {
          block: 'write \'Hello.\'',
          title: 'Write text in the document'
        }, 
        // {
        //   block: 'debug x',
        //   title: 'Log an object to debug'
        // }, {
        //   block: 'type \'zz*(-.-)*zz\'',
        //   title: 'Typewrite text in the document'
        // }, {
        //   block: 'typebox yellow',
        //   title: 'Type out a colored square'
        // }, {
        //   block: 'typeline()',
        //   title: 'Type in a new line'
        // }, {
        //   block: '@label \'spot\'',
        //   title: 'Write text at the turtle'
        // }, {
        //   block: "await read '?', defer x",
        //   title: "Pause for input from the user"
        // }, {
        //   block: "await readnum '?', defer x",
        //   title: "Pause for a number from the user"
        // }, {
        //   block: 'read \'?\', (x) ->\n  write x',
        //   title: 'Send input from the user to a function'
        // }, {
        //   block: 'readnum \'?\', (x) ->\n  write x',
        //   title: 'Send a number from the user to a function'
        // }
      ])
    }, 
    //{
    //   name: 'Sprites',
    //   color: 'teal',
    //   blocks: filterblocks([
    //     {
    //       block: 't = new Turtle red',
    //       title: 'Make a new turtle',
    //       id: 'newturtle'
    //     }, {
    //       block: 's = new Sprite()',
    //       title: 'Make a blank sprite',
    //       id: 'newsprite'
    //     }, {
    //       block: 'p = new Piano()',
    //       title: 'Make a visible instrument',
    //       id: 'newpiano'
    //     }, {
    //       block: 'q = new Pencil()',
    //       title: 'Make an invisible and fast drawing sprite'
    //     }, {
    //       block: 'if @touches x\n  ``',
    //       title: 'Do something only if touching the object x'
    //     }, {
    //       block: 'if @inside window\n  ``',
    //       title: 'Do something only if inside the window'
    //     }
    //   ])
    // }, {
    //   name: 'Sound',
    //   color: 'indigo',
    //   blocks: filterblocks([
    //     {
    //       block: '@play \'c G/G/ AG z\'',
    //       title: 'Play music notes in sequence'
    //     }, {
    //       block: '@play \'[fA] [ecG]2\'',
    //       title: 'Play notes in a chord'
    //     }, {
    //       block: '@tone \'B\', 2, 1',
    //       title: 'Sound a note immediately',
    //       id: 'toneNote'
    //     }, {
    //       block: '@tone \'B\', 0',
    //       title: 'Silence a note immediately',
    //       id: 'toneNote0'
    //     }, {
    //       block: '@tone 440, 2, 1',
    //       title: 'Sound a frequency immediately',
    //       id: 'toneHz'
    //     }, {
    //       block: '@tone 440, 0',
    //       title: 'Silence a frequency immediately',
    //       id: 'toneHz0'
    //     }, {
    //       block: '@silence()',
    //       title: 'Silence all notes'
    //     }, {
    //       block: "await listen defer x",
    //       title: "Pause for spoken words from the user"
    //     }, {
    //       block: 'listen (x) ->\n  write x',
    //       title: 'Send spoken words from the user to a function'
    //     }, {
    //       block: '@say \'hello\'',
    //       title: 'Speak a word'
    //     }, {
    //       block: 'new Audio(url).play()',
    //       expansion: '(new Audio(\'https://upload.wikimedia.org/wikipedia/commons/1/11/06_-_Vivaldi_Summer_mvt_3_Presto_-_John_Harrison_violin.ogg\')).play()',
    //       title: 'Play an audio file'
    //     }
    //   ])
    // }, 
    {
      name: 'Snippets',
      color: 'deeporange',
      blocks: filterblocks([
        {
          block: "(turtle.remove()\nsize = 40\nplayers = hatch size\nplayerState = ( last: 'i', payoff: 0, color: random [red,purple,indigo,lime,orange,pink,blue,green] for [0..size]) \nplayers.plan (i) -> \n  @@moveto [100*random(normal),100*random(normal)]\n  @rt [360*random(normal)]\n  @wear playerState[i].color\nspeed Infinity)",
          title: "Set up cooperation world",
          id: "cooperation-setup"
        },
        {
          block: "GetPayoff = (me,them) ->\n  switch me + them\n    when 'cc' then [3,3]\n    when 'cd' then [0,5]\n    when 'dc' then [5,0]\n    when 'dd' then [1,1]",
          title: "Function for payoff, taking into account whether both sides (c)ooperated or (d)efected",
          id: "get-payoff"
        },
        {
          block: "GetStrategy = (color,state) ->\n  rule = \n    switch color\n      when 'red' then     { i: 'd', c: 'd', d: 'd', name: 'All Defect' }\n      when 'purple' then  { i: 'd', c: 'd', d: 'c', name: 'Suspicious Perverse' }\n      when 'indigo' then  { i: 'd', c: 'c', d: 'd', name: 'Suspicious Tit-for-Tat' }\n      when 'lime' then    { i: 'd', c: 'c', d: 'c', name: 'D-then-All-Cooperate' }\n      when 'orange' then  { i: 'c', c: 'd', d: 'd', name: 'C-then-All-Defect' }\n      when 'pink' then    { i: 'c', c: 'd', d: 'c', name: 'Perverse' }\n      when 'blue' then    { i: 'c', c: 'c', d: 'd', name: 'Tit-for-Tat' }\n      when 'green' then   { i: 'c', c: 'c', d: 'c', name: 'All Cooperate' }\n      else   { i: 'c', c: 'c', d: 'c', name: 'All Cooperate' }\n  strategy =\n    switch state\n      when state is 'i' then rule.i\n      when state is 'c' then rule.c\n      when state is 'd' then rule.d\n      else rule.i\n  return strategy",
          title: "Function for cooperation strategy, taking into account player type/color and state/last action against",
          id: "get-strategy"
        },
        {
          block: "HandleTouch = (i) ->\n  me = players.eq(i)\n  for j in [0..size]\n    other = players.eq(j)\n    if me.touches(other)\n      meStrategy = GetStrategy playerState[i].color,playerState[i].last\n      otherStrategy = GetStrategy  playerState[j].color,playerState[j].last\n      playerState[i].payoff += GetPayoff meStrategy,otherStrategy\n      playerState[j].payoff = GetPayoff otherStrategy,meStrategy\n      if playerState[i].payoff > playerState[j].payoff\n        playerState[j].color = playerState[i].color\n        other.wear playerState[j].color\n        playerState[j].payoff = 0\n      else \n        playerState[i].color = playerState[j].color\n        me.wear playerState[i].color\n        playerState[i].payoff = 0\n      playerState[i].last = otherStrategy\n      playerState[j].last = meStrategy\n      me.label playerState[i].last",
          title: "Function for handling collisions",
          id: "handle-touch"
        },
        {
          block: "tick 10, ->\n  do cg\n  players.plan (i) -> \n    HandleTouch i\n    if not @@inside(window)\n      @moveto [100*random(normal),100*random(normal)]\n      @rt [360*random(normal)]\n    @fd 1\n    @rt random [0,1]",
          title: "Run cooperation simulation",
          id: "run-cooperation-simulation"
        },
        // {
        //   block: "forever 10, ->\n  turnto lastmouse\n  fd 2",
        //   title: 'Continually move towards the last mouse position',
        //   id: "foreverFollowMouse"
        // }, {
        //   block: "forever 10, ->\n  if pressed 'W'\n    fd 2",
        //   title: 'Poll a key and move while it is depressed',
        //   id: "foreverPollKey"
        // }, {
        //   block: "forever 1, ->\n  fd 25\n  if not inside window\n    stop()",
        //   title: 'Move once per second until not inside window',
        //   id: "foreverInsideWindow"
        // }, {
        //   block: "click (e) ->\n  moveto e",
        //   title: 'Move to a location when document is clicked',
        //   id: "foreverMovetoClick"
        // }, {
        //   block: "button \'Click\', ->\n  write 'clicked'",
        //   title: 'Make a button and do something when clicked',
        //   id: "buttonWrite"
        // }, {
        //   block: "keydown \'X\', ->\n  write 'x pressed'",
        //   title: 'Do something when a keyboard key is pressed',
        //   id: "keydownWrite"
        // }, {
        //   block: "click (e) ->\n  moveto e",
        //   title: 'Move to a location when document is clicked',
        //   id: "clickMove"
        // }
      ])
    }
  ]
}
);
</script>
</head><body><h1>Game Theory and Cooperation</h1>

<p>This simulation emulates the Iterated Prisoner's Dilemma</p>

<p>There are 8 kinds of players defined by the color of the turtle shell.</p>
<ul>
    <li>All Defect - Will always defect</li>
    <li>Suspicious Perverse - Will defect initially, defect when others cooperate, and cooperate when others defect</li>
    <li>Suspicious Tit-for-Tat - Will defect initially, cooperate when others cooperate, and defect when others defect</li>
    <li>D-then-All-Cooperate - Will defect initially, then always cooperate</li>
    <li>C-then-All-Defect - Will cooperate initially, then always defect</li>
    <li>Perverse - Will cooperate initially, defect when others cooperate, and cooperate when others defect</li>
    <li>Tit-for-Tat - Will cooperate initially, cooperate when others cooperate, and defect when others defect</li>
    <li>All Cooperate - Will always cooperate</li>
</ul>

<p>In this simulation, every encounter updates the payoff accumulated by the turtles.
   If one turtle has higher accumulated payoff than the other, then it converts the
   other turtle to its type and sets the turtle's payoff to zero. Over time, the successful
   types convert all the others.
</p> 

<p>Check the Snippets palette and get the rules, set up the simulation, and run the simulation.</p>

</body></html>
